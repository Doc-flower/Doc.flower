<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>查看全文</title>
    <link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/bootstrap-4.6.0-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/person.css">
    <link rel="stylesheet" href="../css/blog.css" type="text/css">
    <link rel="stylesheet" href="../css/footer.css">
    <script>
        var id=window.localStorage.getItem('ID');
        var comment_height=260;
        var comment_area_height=330;

        window.onload = function (){
            blog_search();
            comment_search();
            //cookie_email_search();
        }

        function  blog_search(){
            console.log(window.localStorage.getItem('ID'));
            console.log(typeof id);
            var url = "../../../BlogsServlet";
            if (window.XMLHttpRequest)
                req = new XMLHttpRequest();
            else if (window.ActiveXObject)
                req = new ActiveXObject("Microsoft.XMLHTTP");
            if (req) {
                //采用POST方式，异步传输
                req.open("post", url, true);
                //POST方式，必须加入如下头信息设定
                req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                req.onreadystatechange = searchComplete;
                req.send("type=searchId&id="+id);
                console.log("完成搜索");
            }
        }

        function searchComplete() {
             console.log("进入搜索");
            if (req.readyState == 4 && req.status == 200) {
                var json =  JSON.parse(req.responseText);//转换为json对象
                document.getElementsByClassName("my_card")[0].innerHTML="";
                if(json.length > 0) {
                    for (i = 0; i < json.length; i++) {
                        document.getElementsByClassName("my_card")[0].innerHTML +=' <div class="card-header">\n' +
                            '        '+json[i].name+'\n' +
                            '    </div>\n' +
                            '    <p class="card-body my_card-body">\n' +
                            '      '+json[i].text+'\n'+
                            '    </p>\n';
                    console.log(json[i].name);
                    }
                }else {
                    document.getElementById("flower_list").innerHTML =
                        '<div class="mx-auto text-center  py-5">'+
                        '        <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" fill="currentColor" class="bi bi-emoji-frown" viewBox="0 0 16 16">\n' +
                        '            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>\n' +
                        '            <path d="M4.285 12.433a.5.5 0 0 0 .683-.183A3.498 3.498 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.498 4.498 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683zM7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"/>\n' +
                        '        </svg>'+
                        '        <h1 class="text-dark mx-auto my-5">抱歉，没有找到该博客...</h1>'+
                        '</div>';
                }
            }
        }

        function  comment_search(){

            var url = "../../../CommentsServlet";
            if (window.XMLHttpRequest)
                req1 = new XMLHttpRequest();
            else if (window.ActiveXObject)
                req1 = new ActiveXObject("Microsoft.XMLHTTP");
            if (req1) {
                //采用POST方式，异步传输
                req1.open("post", url, true);
                //POST方式，必须加入如下头信息设定
                req1.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                req1.onreadystatechange = searchComplete1;
                req1.send("type=search__BlogId&id="+id);
            }
        }

        function searchComplete1() {

            if (req1.readyState == 4 && req1.status == 200) {
                var json =  JSON.parse(req1.responseText);//转换为json对象
                document.getElementById("comment_li_list").innerHTML="";
                if(json.length > 0) {
                    for (i = 0; i < json.length; i++) {
                        document.getElementById("comment_li_list").innerHTML +='<li>\n' +
                            '                    <div class="other">\n' +
                            '                        <span class="date">'+json[i].comment_time+'</span>\n' +
                            '                        <span class="iconfont c">&#xec8c;</span>\n' +
                            '                        <span class="like">'+json[i].comment_likes+'</span>\n' +
                            '                    </div>\n' +
                            '                    <div class="user">\n' +
                            '                        <div class="user_img">\n' +
                            '                            <img src="'+json[i].comment_image+'" alt="">\n' +
                            '                        </div>\n' +
                            '                    </div>\n' +
                            '                    <div class="body">\n' +
                            '                        <div class="user_name">'+json[i].comment_owner+'</div>\n' +
                            '                        <div class="text">'+json[i].comment_text+'</div>\n' +
                            '                    </div>\n' +
                            '                </li>';
                        comment_height+=180;
                        comment_area_height+=180;
                        var temp1=comment_height+"px";
                        var temp2=comment_area_height+"px";
                        document.getElementById("comment").style.height=temp1;
                        document.getElementById("comment_area").style.height=temp2;
                    }
                }
            }
        }

        function func4(){
            //获取当前时间
            var d=new Date();
            var year=d.getFullYear();
            var month=d.getMonth()+1;
            var day=d.getDate();
            var time=year+"年"+month+"月"+day+"日";
            //获取文本内容
            var text=document.my_form.textarea.value;
            //创建一个新的li
            var comment_li_list=document.getElementById("comment_li_list");
            var li_node=document.createElement("li");
            var other_node=document.createElement("div");
            other_node.setAttribute("class","other");
            other_node.innerHTML='<span class="date">'+time+'</span>\
                            <span class="iconfont c">&#xec8c;</span>\
                            <span class="like">赞</span>';
            var user_node=document.createElement("div");
            user_node.setAttribute("class","user");
            user_node.innerHTML='<div class="user_img">\
                                <img src="../img/user_img.jpg" alt="">\
                            </div>';
            var body_node=document.createElement("div");
            body_node.setAttribute("class","body");
            body_node.innerHTML='<div class="user_name">匿名用户</div>\
                             <div class="text">'+text+'</div>';
            li_node.appendChild(other_node);
            li_node.appendChild(user_node);
            li_node.appendChild(body_node);
            //增加一个评论，对应的地方也要变长
            comment_height+=180;
            comment_area_height+=180;
            var temp1=comment_height+"px";
            var temp2=comment_area_height+"px";
            document.getElementById("comment").style.height=temp1;
            document.getElementById("comment_area").style.height=temp2;

            comment_li_list.insertBefore(li_node,comment_li_list.firstChild);
            /*对输入框清空*/
            document.my_form.reset();
            return false;
        }

        function quit(){
            document.cookie = "name=???";
            window.location = "Sign.html";
        }

        function cookie_email_search(){
            var url = "../../../CustomerServlet";
            if (window.XMLHttpRequest)
                req = new XMLHttpRequest();
            else if (window.ActiveXObject)
                req = new ActiveXObject("Microsoft.XMLHTTP");
            if (req) {
                //采用POST方式，异步传输
                req.open("post", url, true);
                req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                req.onreadystatechange = cookie_email_searchComplete;
                req.send("type=search&method=byEmail&" + document.cookie);
            }
        }

        function cookie_email_searchComplete(){
            if (req.readyState == 4 && req.status == 200) {
                console.log(req.responseText);

                var json =  JSON.parse(req.responseText);//转换为json对象
                console.log(json);

                console.log("---------->成功:" + document.cookie);
                document.getElementById("dropdown04").innerText = json[0].name;
                document.getElementById("IfUserSginIn").innerHTML = '';

                document.getElementById("person_name").innerText = json[0].name;
                document.getElementById("person_email").innerText = json[0].email;
                document.getElementById("container").setAttribute("style","");

            } else{
                document.getElementById("IfUserSginIn").innerHTML = '<a href="Sign.html"><input type="button" class="btn btn-outline-primary mt-2" id="user" href="Sign.html" value="登录/注册"></a>\n'
                document.getElementById("dropdown04").innerText = "个人中心";
                document.getElementById("person_name").innerText = "请先登录";

                console.log("---------->失败:" + document.cookie);
            }
        }


    </script>


</head>
<body>
<nav>
    <div class="nav_main">

        <img src="../../public/img/logo.png" height="30" width="30" alt="."/>
        <div class="nav_main_title">
            <ul>
                <li><a href="./index.html">首页</a> </li>
                <li><a href="./HuaXiaoKe.html">花小科</a></li>
                <li><a href="HuaXiaoShi_Flowers.html">花花小市</a></li>
                <li><a href="HuaXiaoShi_Plants.html">绿植小市</a></li>
                <li><a href="./HuaXiaoQuan.html">花小圈</a></li>

            </ul>
        </div>
        <div class="nav_main_user">
            <div class="col-md-5 float-left" id="IfUserSginIn" >

            </div>
            <div class="nav-item dropdown col-md-6 float-right">
                <a class="nav-link dropdown-toggle" href="#" id="dropdown04" data-toggle="dropdown" aria-expanded="false">个人中心</a>
                <div class="dropdown-menu" aria-labelledby="dropdown04">
                    <a class="dropdown-item" href="Person.html" target="_blank">个人信息</a>
                    <a class="dropdown-item" href="Person_Order.html" target="_blank">订单管理</a>
                    <a class="dropdown-item" href="javascript:;" onclick="quit()">退出登录</a>
                </div>
            </div>
        </div>
    </div>

</nav>

<!--博客全文区 -->
<div class="card my_card">

</div>
       <!--评论区 -->
<div id="comment_area">
    <div id="header">
        <span class="font">网友评论</span>
        <span class="sort_quality">质量排序</span>
        <span class="sort_time">时间排序</span>
    </div>
    <div id="comment">
        <div id="comment_ul">
            <ul id="comment_li_list">
               <!-- <li>
                    <div class="other">
                        <span class="date">2021年10月20日</span>
                        <span class="iconfont c">&#xec8c;</span>
                        <span class="like">赞</span>
                    </div>
                    <div class="user">
                        <div class="user_img">
                            <img src="../img/user_img.jpg" alt="">
                        </div>
                    </div>
                    <div class="body">
                        <div class="user_name">134523</div>
                        <div class="text">很好吃！</div>
                    </div>
                </li>
                <li>
                    <div class="other">
                        <span class="date">2021年10月20日</span>
                        <span class="iconfont c">&#xec8c;</span>
                        <span class="like">赞</span>
                    </div>
                    <div class="user">
                        <div class="user_img">
                            <img src="../img/user_img.jpg" alt="">
                        </div>
                    </div>
                    <div class="body">
                        <div class="user_name">fdhjgg</div>
                        <div class="text">难吃......</div>
                    </div>
                </li>-->

            </ul>
        </div>
        <div id="comment_input">
            <div class="input_user">
                <div class="input_user_img">
                    <img src="../img/user_img.jpg" alt="">
                </div>
            </div>
            <div class="input_body">
                <div class="input_title">我要评论</div>
                <div class="input_text">
                    <form name="my_form" action="#" method="post" onsubmit="return func4()">
                        <textarea name="textarea" id="textarea"></textarea>
                        <button class="submit">提交评论</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<footer class="mt-5 pt-3">
    <div class="footer_main mx-auto col-md-6 clearfix">
        <div class="footer_main_icon text-center py-2">
            <img src="../../public/img/logo_white.png" height="90" width="90" alt="."/>
            <div class="footer_main_text col-md-8 text-center py-2 float-right">
                    <span class="footer_main_text_name">
                        花博士线上花城
                    </span>
                <br>
                <span class="footer_main_text_email">
                        https://github.com/Doc-flowers/Doc.flowers.Web.git
                    </span>
                <br>
                <span class="footer_main_text_company">
                        @2021 花悦文化有限公司
                    </span>
            </div>
        </div>
    </div>
</footer>


<script src="../../public/js/jquery-1.12.4.min.js"></script>
<script src="../../public/css/bootstrap-4.6.0-dist/js/bootstrap.bundle.js"></script>

<script src="../../public/css/bootstrap-4.6.0-dist/js/bootstrap.min.js"></script>
</body>
<script>
    /*点击提交按钮，按钮发生变化，并将输入数据(文本)及日期读取下来，生成一个新评论*/
    var btn=document.getElementsByClassName("submit")[0];
    btn.onmousedown=function(){
        btn.style.backgroundColor="#ffffff";
        btn.style.color="#f29f39";
        btn.style.border="1px solid #f29f39";
    }
    btn.onmouseup=function(){
        btn.style.backgroundColor="#f29f39";
        btn.style.color="#ffffff";
        btn.style.border="1px solid #f29f39";
    }
</script>
</html>